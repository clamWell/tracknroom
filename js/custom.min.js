function sendSns(t){var e=encodeURIComponent(location.href),i=encodeURIComponent($("title").html());switch(t){case"facebook":window.open("http://www.facebook.com/sharer/sharer.php?u="+e);break;case"twitter":window.open("http://twitter.com/intent/tweet?text="+i+"&url="+e)}}$(function(){var t=$(window).width(),e=$(window).height(),r="http://img.khan.co.kr/spko/storytelling/2020/tracknroom/",n=t<=800;window.onbeforeunload=function(){window.scrollTo(0,0)};var l,o,s=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)};function p(t,e){var i=e;switch(t){case"card":return"<div class='hideme timeline-el el-card el-with-img "+i+"'><p class='el-year'><span class='year'></span><span class='spot'></span></p><div class='card-body'><div class='arrow'><img src='"+r+i+".jpg' alt=''></div><div class='card-thumb'><img src='' alt=''><div class='thumb-shade'></div></div><div class='card-text'><p class='card-title'></p><p class='card-desc-point'></p></div><div class='view-card'><p>사건 설명 더보기</p></div></div><div class='card-share'><div class='share_fb'><img src='"+r+"fb_icon_line_w.png' alt='페이스북' /></div><div class='share_tw'><img src='"+r+"tw_icon_line_w.png' alt='트위터' /></div></div></div>";case"simple-card":return"<div class='hideme timeline-el el-simple-card el-no-img "+i+"'><p class='el-year'><span class='year'></span><span class='spot'></span></p><div class='card-body'><div class='arrow'><img src='' alt=''></div><div class='card-text'><p class='card-title'></p><p class='card-desc-point'></p></div></div></div>";case"simple":return"<div class='hideme timeline-el el-simple "+i+"'><p class='el-year'><span class='year'></span><span class='spot'></span></p><div class='card-body'><div class='card-text'><p class='card-title'></p></div></div></div>"}}function u(){$(".each-section").each(function(t,e){$(e).find(".section-body").html("")});var t=cardData;for(d=0;d<t.length;d++){var e=String(t[d].sec).replace("s",""),i=p(t[d].elType,t[d].id);$(".each-section").eq(e-1).find(".section-body").append(i);var a=$("."+t[d].id);a.attr("data-id",t[d].id),a.find(".el-year .year").html(t[d].ymd),a.find(".card-title").html(t[d].title),a.addClass("el-"+t[d].line),null!==t[d].shareAble&&"o"==t[d].shareAble&&a.addClass("card-shareable"),1==n?("center"==t[d].line?a.find(".arrow").addClass("arrow-up"):"right"==t[d].line?a.find(".arrow").addClass("arrow-right"):"left"==t[d].line&&a.find(".arrow").addClass("arrow-left"),a.find(".arrow img").attr("src",r+"arrow-up.png")):"center"==t[d].line?(a.find(".arrow").addClass("arrow-up"),a.find(".arrow img").attr("src",r+"arrow-up.png")):"right"==t[d].line?(a.find(".arrow").addClass("arrow-right"),a.find(".arrow img").attr("src",r+"arrow-right-2.png")):"left"==t[d].line&&(a.find(".arrow").addClass("arrow-left"),a.find(".arrow img").attr("src",r+"arrow-left-2.png")),null!==t[d].pointTxt&&a.find(".card-desc-point").length&&a.find(".card-desc-point").html(t[d].pointTxt),null!==t[d].thumb&&a.find(".card-thumb").length&&a.find(".card-thumb img").attr("src",r+t[d].id+".jpg"),null!==t[d].relCode&&(a.append("<div class='show-rel-card'><div class='rel-icon'><img src="+r+"rel-icon-2.png' alt='관련사건타래보기'><span class='icon-desc'>사건 타래 보기</span></div></div>"),a.find(".show-rel-card").attr("data-rel-id",t[d].relCode),a.addClass("el-with-rel")),d==t.length-1&&(h(),m(),g())}}function h(){$(".each-section").each(function(t,e){var i=$(e).find(".timeline-el");if(0!==i.length){var a;a=Number(i.eq(i.length-1).css("top").replace("px",""))+i.eq(i.length-1).height()+20,$(e).find(".section-body").css({height:a+"px"})}}),O=$(".timeline-holder").offset().top+$(".timeline-holder").height(),R=$(".sec-title--15").offset().top,S=1==n?$(".ending-graphic").offset().top-.4*e:$(".ending-graphic").offset().top}function m(){var t=1==n?"exit-icon-b-2":"exit-icon-or-big";$(".timeline-el").each(function(e,i){$(i).append("<div class='filter-card-navi'><div class='arr-up'><img src='http://img.khan.co.kr/spko/storytelling/2020/tracknroom/arr-up-or-bold.png' alt='이전'></div><div class='arr-down'><img src='http://img.khan.co.kr/spko/storytelling/2020/tracknroom/arr-down-or-bold.png' alt='다음'></div><div class='filter-exit'><img src='http://img.khan.co.kr/spko/storytelling/2020/tracknroom/"+t+".png' alt='필터링끄기'></div><div class='arr-info'><span class='f_i'></span><span class='slash'>/</span><span class='total'></span></div></div>")})}function g(){$(".timeline-el").each(function(t,e){$(e).hasClass("el-with-rel")&&$(e).append("<svg id='svg-"+$(e).attr("data-id")+"'></svg>")}),pathValue.forEach(function(t,e,i){var a=String("svg-s"+t.sec+"-e"+t.el),r=document.getElementById(a).appendChild(document.createElementNS("http://www.w3.org/2000/svg","path"));n?r.setAttributeNS(null,"d",t.m):r.setAttributeNS(null,"d",t.pc)})}function v(t,a){var r=d3.select(t),n=r.append("defs").append("filter").attr("id","glow");n.append("feGaussianBlur").attr("class","blur").attr("stdDeviation","4.5").attr("result","coloredBlur");var l=n.append("feMerge");l.append("feMergeNode").attr("in","coloredBlur"),l.append("feMergeNode").attr("in","SourceGraphic");var o=r.append("g").attr("class","bubble-g bubble-g--1"),d=r.append("g").attr("class","bubble-g bubble-g--random"),c=$(".bubble-traffic-holder").width(),f=$(".bubble-traffic-holder").height(),p="end"==a?1600:1200;for(i=0;i<p;i++){var u=i/30;o.append("circle").attr("class","traffic-plots").attr("data-cx",function(){return"end"==a?500*Math.cos(u)+s(-300,300)+c/2:s(-c,c)}).attr("data-cy",function(){return"end"==a?150*Math.sin(u)+s(-80,80)+f/2:s(0,4*e)}).attr("cx",function(){return"end"==a?s(-c,c):500*Math.cos(u)+s(-300,300)+c/2}).attr("cy",function(){return"end"==a?-s(0,3*e):150*Math.sin(u)+s(-80,80)+f/2}).attr("r",function(){return s(2,3)}).style("fill-opacity",function(){if("end"==a)var t=s(0,10);else t=s(70,100);return t/100}).style("fill",function(){var t=s(1,3);return"1"==t?"#ff7826":"2"==t?"#de1500":"3"==t?"#ff4200":"#ff8352"})}for(i=0;i<300;i++)d.append("circle").attr("class","traffic-plots").attr("data-cx",function(){return s(1.5*-c,1.5*c)}).attr("data-cy",function(){return s(.2*-f,1.2*f)}).attr("cx",function(){return s(-c,c)}).attr("cy",function(){return"end"==a?-s(0,2.5*e):s(0,500)}).attr("r",function(){return s(1,3)}).style("fill-opacity",function(){if("end"==a)var t=s(0,10);else t=s(30,60);return t/100}).style("fill",function(){var t=s(1,3);return"1"==t?"#f86302":"2"==t?"#de1500":"3"==t?"#ff4200":"#ff8352"})}function b(t,e){if("end"==e)var i=d3.selectAll("#END_TRAFFIC .traffic-plots");else i=d3.selectAll("#INTRO_TRAFFIC .traffic-plots");i.transition().duration(function(){return s(2e3,7e3)}).ease(d3.easeQuadInOut).attr("cx",function(){return d3.select(this).attr("data-cx")}).attr("cy",function(){return d3.select(this).attr("data-cy")}).style("fill-opacity",function(){return"end"==e?s(70,100)/100:0}),setTimeout(function(){"end"==e&&($(".bubble-traffic-holder .img-back").fadeIn(1e3,function(){for(f=0;f<$(".traffic-nroom").length;f++)$(".bubble-traffic-holder .img-front .traffic-front").eq(f).delay(300*f).fadeIn(1e3),$(".traffic-nroom").eq(f).delay(300*f).fadeIn(1e3)}),$("body").removeClass("fixed"))},3e3)}function w(t){var e;for(c=0;c<cardData.length;c++)if(cardData[c].id==t){e=cardData[c];break}$(".popUp-front").find(".year").html(e.ymd),$(".popUp-front").find(".thumb-holder img").attr("src","http://img.khan.co.kr/spko/storytelling/2020/tracknroom/"+e.thumb+".jpg"),$(".popUp-front").find(".popUp-card-title").html(e.title),$(".popUp-front").find(".popUp-card-point-text p").html(e.pointTxt),$(".popUp-front").find(".popUp-card-full-text").html(e.fullTxt);var i=new Array;null!==e.tag?(i=e.tag.split(","),$(".popUp-card-tag .tag-list").html(""),i.map(function(t,e,i){if(i[e].length>0){var a="<span>"+i[e]+"</span>";$(".popUp-card-tag .tag-list").append(a)}}),$(".popUp-card-tag").show()):$(".popUp-card-tag").hide(),$(".popUp-layer").show(),$(".popUp-body .popUp-card-full-text").scrollTop(0),$(".popUp-body .body-scroll").scrollTop(0),$(".popUp-front").animate({top:"0px",opacity:"1"},400,"easeOutCubic")}function y(){$(".popUp-front").css({top:"100px",opacity:"0"}),$("body").removeClass("fixed"),G=!0,q(),$(window).scrollTop(j)}$(window).resize(function(){t=$(window).width(),e=$(window).height(),$(".top-graphic-device img").css("width",2*$(".top-graphic-device").width()),I($(".top-graphic-device img"),600)}),$(".close-ie-block").on("click",function(){$(".ie-block-9").hide()}),l=d3.range(600).map(function(t){return{radius:s(2,3)}}),d3.forceSimulation(l).force("charge",d3.forceManyBody().strength(1)).force("center",d3.forceCenter(300,300)).force("collision",d3.forceCollide().radius(function(t){return t.radius})).on("tick",function(){var t=o.selectAll("circle").data(l);t.enter().append("circle").attr("r",function(t){return t.radius}).merge(t).attr("cx",function(t){return t.x}).attr("fill",function(){var t=s(1,3);return"1"==t?"#f86302":"2"==t?"ff2a672":"3"==t?"#ff4200":"#f86302"}).attr("cy",function(t){return t.y}),t.exit().remove()}),o=d3.select("#SVG_BUBBLE svg").attr("width",600).attr("height",600).append("g").attr("class","bubble-holder"),v("#INTRO_TRAFFIC","intro"),v("#END_TRAFFIC","end");var k,C,x=!1;function U(t,e){for($(".timeline-el").addClass("timeline-el-off"),$(".sec-title").addClass("sec-title-off"),$("#SVG_BUBBLE").addClass("svg-bubble-off"),$(".line-body-end").addClass("line-body-end-off"),a=0;a<t.length;a++)1==e?$("."+t[a]).addClass("timeline-el-focus"):0==e&&$("."+t[a]).addClass("timeline-el-focus timeline-el-noPath"),$("."+t[a]).attr("data-focus-index",a),$("."+t[a]).find(".f_i").html(a+1),$("."+t[a]).find(".total").html(t.length);$(".timeline-el-focus").find(".arr-up").show(),$(".timeline-el-focus").find(".arr-down").show(),$(".timeline-el-focus").eq(0).find(".arr-up").hide(),$(".timeline-el-focus").eq(t.length-1).find(".arr-down").hide()}function T(t){var i=t.replace("#",""),r=new Array;for(c=0;c<cardData.length;c++)null!==cardData[c].tag&&-1!==cardData[c].tag.indexOf(i)&&r.push(cardData[c].id);U(r,!1),function(t){for(P=[],a=0;a<t.length;a++)P.push($("."+t[a]).offset().top);return i=P[0]-.4*e,$("html, body").animate({scrollTop:i},700,"easeOutCubic"),L=!1,$(".filter-toggle").removeClass("filter-toggle-on"),$(".filter-list").slideUp(),P;var i}(r)}function _(){$(".filter-list ul li").removeClass("on"),$(".filter-list ul li").remove(".exit"),$(".timeline-el").removeClass("timeline-el-off timeline-el-focus timeline-el-noPath"),$(".timeline-el").removeAttr("data-focus-index"),$(".sec-title").removeClass("sec-title-off"),$("#SVG_BUBBLE").removeClass("svg-bubble-off"),$(".line-body-end").removeClass("line-body-end-off"),$(".fixed-focus-item-list").hide(),$(".filter-toggle-button").removeClass("filter-toggle-button-selected"),$(".filter-toggle-button").removeClass("button-block")}function I(t,e){clearInterval(C);var i=t,a=i.width()/2;function r(){i.css({left:-a+"px"}),setTimeout(function(){i.css({left:0}),setTimeout(function(){i.css({left:-a+"px"})},e)},e)}C=setInterval(function(){r()},2*e)}if($(".section-body").delegate(".show-rel-card","click",function(){0==x&&(x=!0,function(t){$(".fixed-focus-item-list .focus-title .code").html(t),$(".fixed-focus-item-list .item-list-wrap ul").html("");var e=new Array;for(c=0;c<cardData.length;c++)cardData[c].relCode==t&&(e.push(cardData[c].id),i=cardData[c].title,r=void 0,r="<li>"+i+"</li>",$(".fixed-focus-item-list .item-list-wrap ul").append(r));var i,r;(function(t){for(k=[],a=0;a<t.length;a++)k.push($("."+t[a]).offset().top);k[0],$(".filter-toggle-button").addClass("button-block"),L=!1,$(".filter-toggle").removeClass("filter-toggle-on"),$(".filter-list").slideUp(),n||$(".fixed-focus-item-list").fadeIn()})(e),U(e,!0)}($(this).attr("data-rel-id")))}),I($(".top-graphic-device img"),600),1==n)$(".sec--5 .sec-title .img-title img").attr("src","http://img.khan.co.kr/spko/storytelling/2020/tracknroom/sec-title-05-m.png"),$(".sec--7 .sec-title .img-title img").attr("src","http://img.khan.co.kr/spko/storytelling/2020/tracknroom/sec-title-07-m.png"),$(".sec--8 .sec-title .img-title img").attr("src","http://img.khan.co.kr/spko/storytelling/2020/tracknroom/sec-title-08-m.png"),$(".video-boxing iframe").css({width:$(".blank img").width(),height:$(".blank img").height()});else{var D=($(".story-header").height()-$(".story-header-front").height())/2-40;$(".story-header-front").css({top:D+"px"}),L=!0,$(".filter-toggle").addClass("filter-toggle-on"),$(".filter-list").slideDown()}$(".loading-page").fadeOut(200,function(){u(),y(),$(".story-header-front").fadeIn(1e3)});var A=!1,N=1==n?$(".time-warp").offset().top-.3*e:$(".time-warp").offset().top-.2*e,B=N,E=$(".timeline-holder").offset().top,O=0;var R,S,F=!1,M=!1,G=!0;function q(){$("body").removeClass("scrollDisable").off("scroll touchmove mousewheel")}$(window).scroll(function(t){var i=$(window).scrollTop();if(0==G)return t.preventDefault(),t.stopPropagation(),!1;var a=(i-E+e)/$(".timeline-holder").height()*100;i>N&&0==A&&($("body").addClass("fixed"),G=!1,$("html, body").animate({scrollTop:B},300,"easeOutCubic",function(){0==A&&(A=!0,b(0,"intro"),setTimeout(function(){$("body").removeClass("fixed"),G=!0,q(),$(".top-timewarp-graphic .center-display").fadeOut(1e3),$(".time-warp").addClass("time-warp-after"),$("#YEAR_COUNTING").animate({opacity:"1"},1500),$(".timeline-area").animate({opacity:"1"},1500,function(){$("#INTRO_TRAFFIC").html("")})},3e3))})),i>=E&&i<O?($(".card-filter").addClass("card-filter-fixed"),$(".fixed-navi").fadeIn(),1==n?$(".progress").css({width:a+"%"}):$(".progress").css({height:a+"%"})):(i<E||i>=O)&&($(".card-filter").removeClass("card-filter-fixed"),$(".fixed-navi").hide()),i>R&&0==F&&(F=!0,d3.select("#SVG_BUBBLE svg").selectAll("circle").transition().duration(function(){return Math.floor(2e3*Math.random())}).style("fill-opacity",function(){return s(30,100)/100}).style("fill",function(){var t=s(1,3);return"1"==t?"#f86302":"2"==t?"#de1500":"3"==t?"#ff4200":"#ff8352"})),i+e>S&&0==M&&(M=!0,b(0,"end"),$(".ending-graphic .center-display").fadeIn()),$(".hideme").each(function(t){i+e>$(this).offset().top+.5*$(this).outerHeight()&&$(this).stop().animate({opacity:"1"},1e3)})}),$(".popUp-body .body-scroll").scroll(function(t){t.stopPropagation(),t.preventDefault()});var L=!1,V=!1,P=(new Array,new Array),j=0;$(".timeline-holder").delegate(".el-card .card-body","mouseover",function(t){n||$(this).addClass("card-body-hover")}).delegate(".el-card .card-body","mouseout",function(){$(this).removeClass("card-body-hover")}).delegate(".el-card .card-body","click",function(t){var e=$(this).parent(".timeline-el").attr("data-id");j=$(window).scrollTop(),$("body").addClass("fixed"),G=!1,w(e)}),$("#CARD_CLOSE_BTN, .popUp-back, .m-close").on("click",function(){$(".popUp-layer").hide(),y()}),$("#FILTER_TOGGLE").on("click",function(t){0==L?(L=!0,$(".filter-toggle").addClass("filter-toggle-on"),$(".filter-list").slideDown()):(L=!1,$(".filter-toggle").removeClass("filter-toggle-on"),$(".filter-list").slideUp())}),$(".filter-list ul li em").on("click",function(t){if(0==V&&!$(this).hasClass("on")){V=!0;var e=$(this).html();$(".hidden-status .value").html(e),$(".filter-toggle-button").addClass("filter-toggle-button-selected"),T(e)}}),$(".hidden-status .user-select").on("click",function(t){1==V&&(V=!1,_())}),$(".section-body").delegate(".filter-exit","click",function(t){1==V?V=!1:1==x&&(x=!1),_()}),$(".section-body").delegate(".arr-up","click",function(t){var i=$(this).parent(".filter-card-navi").parent(".timeline-el").attr("data-focus-index");if(0!==i){if(1==V)var a=P[Number(i)-1]-.4*e;else if(1==x)a=k[Number(i)-1]-.4*e;$("html, body").animate({scrollTop:a},700,"easeOutCubic")}}),$(".section-body").delegate(".arr-down","click",function(t){var i=$(this).parent(".filter-card-navi").parent(".timeline-el").attr("data-focus-index");if(1==V)var a=P[Number(i)+1]-.4*e;else if(1==x)a=k[Number(i)+1]-.4*e;$("html, body").animate({scrollTop:a},700,"easeOutCubic")}),$(".section-body").delegate(".timeline-el .card-share .share_fb","click",function(t){t.preventDefault();var e=$(this).parent(".card-share").parent(".timeline-el").attr("data-id"),i=encodeURIComponent("http://news.khan.co.kr/kh_storytelling/2020/tracknroom/result.html?cardId="+e+"&fbrefresh=NOT_SEEN_BEFORE");return window.open("http://www.facebook.com/sharer/sharer.php?u="+i),!1}),$(".section-body").delegate(".timeline-el .card-share .share_tw","click",function(t){t.preventDefault();var e=$(this).parent(".card-share").parent(".timeline-el").attr("data-id"),i=encodeURIComponent("http://news.khan.co.kr/kh_storytelling/2020/tracknroom/result.html?cardId="+e);return window.open("http://twitter.com/intent/tweet?url="+i),!1})});